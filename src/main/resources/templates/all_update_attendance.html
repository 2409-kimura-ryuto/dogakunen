<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <meta charset="UTF-8">
    <link th:href="@{/css/style.css}" rel="styleSheet">
    <script th:src="@{/js/script.js}"></script>
    <title>勤務表の編集</title>
</head>
<body>
<div class="header-contents">
    <h2 class="text-center my-3">勤務表の編集</h2>
</div>

<div class="alert alert-danger" th:each="errorMessage : ${errorMessages}">
    <p th:text="${errorMessage}"></p>
</div>

<div class="header">
    <form th:action="@{/attendanceLog}" method="get" class="header-item">
        <button type="submit" class="btn btn-secondary me-3">勤務履歴</button>
    </form>
</div>

<br/>
<form th:action="@{/selectMonthAll}" class="selectMonthForm">
    <select name="selectMonthAll" class="form-control selectMonth">
        <!--<option value="" th:each="item : ${map}" th:value="${item.key}" th:text="${item.value}"></option>-->
        <option value="-6" th:text="${pullDown.get(0)}"></option>
        <option value="-5" th:text="${pullDown.get(1)}"></option>
        <option value="-4" th:text="${pullDown.get(2)}"></option>
        <option value="-3" th:text="${pullDown.get(3)}"></option>
        <option value="-2" th:text="${pullDown.get(4)}"></option>
        <option value="-1" th:text="${pullDown.get(5)}"></option>
        <option value="0" th:text="${pullDown.get(6)}" selected></option>
        <option value="1" th:text="${pullDown.get(7)}"></option>
        <option value="2" th:text="${pullDown.get(8)}"></option>
        <option value="3" th:text="${pullDown.get(9)}"></option>
        <option value="4" th:text="${pullDown.get(10)}"></option>
        <option value="5" th:text="${pullDown.get(11)}"></option>
        <option value="6" th:text="${pullDown.get(12)}"></option>
    </select>
    <input type="submit" value="表示" class="btn btn-secondary btn-sm" />
</form>

<a th:href="@{/selectMonthAll(selectMonthAll = -1)}" class="prevMonth">&lt;前月へ</a>
<a th:href="@{/selectMonthAll(selectMonthAll = 1)}">翌月へ&gt;</a>

<form method="post" th:action="@{/updateAll}" th:object="${formModel}" class="text-center">
    <table class="table">
        <thead>
        <tr>
            <th>日付</th>
            <th>勤務区分</th>
            <th>開始時刻</th>
            <th>終了時刻</th>
            <th>休憩時間</th>
            <th>メモ</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="date, iterStat : ${monthDates}">
            <!--日付の表示 -->
            <td>
                <div th:text="${#dates.format(date, 'yyyy年MM月dd日 (E)')}"
                     th:classappend="${#dates.format(date, 'E') == '土' ? 'saturday' : '' +
                      #dates.format(date, 'E') == '日' || #lists.contains(holidays, #dates.format(date, 'yyyy-MM-dd')) ? ' holiday' : ''}">
                </div>
            </td>

            <!-- 勤怠情報の取得 -->
            <span th:switch="${date}">
                <span th:each="dateAttendance : ${dateAttendances}">
                    <!-- 該当する勤怠情報がある場合 -->
                    <p th:case="${dateAttendance.date}">
                      <td>
                        <select th:field="*{attendances[__${iterStat.index}__].attendance}" class="form-select" th:attr="disabled=${monthAttendance.attendanceStatus != 0}">
                          <option th:value="0" th:text="未登録"></option>
                          <option th:value="1" th:text="社内業務（オンサイト）"></option>
                          <option th:value="2" th:text="社内業務（オフサイト）"></option>
                          <option th:value="3" th:text="顧客業務（オンサイト）"></option>
                          <option th:value="4" th:text="顧客業務（オフサイト）"></option>
                          <option th:value="5" th:text="休日"></option>
                        </select>
                      </td>
                      <td>
                        <input type="time" th:field="*{attendances[__${iterStat.index}__].workTimeStart}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
                      </td>
                      <td>
                        <input type="time" th:field="*{attendances[__${iterStat.index}__].workTimeFinish}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
                      </td>
                      <td>
                        <input type="time" th:field="*{attendances[__${iterStat.index}__].breakTime}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
                      </td>
                      <td>
                        <textarea th:field="*{attendances[__${iterStat.index}__].memo}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"></textarea>
                      </td>
                      <input type="hidden" th:field="*{attendances[__${iterStat.index}__].id}" th:value="${dateAttendance.id}"/>
                    </p>
                </span>

          <!-- 該当する勤怠情報がない場合 -->
          <p th:case="*">
              <td>
                <select th:field="*{attendances[__${iterStat.index}__].attendance}" class="form-select" th:attr="disabled=${monthAttendance.attendanceStatus != 0}">
                  <option th:value="0" th:text="未登録"></option>
                  <option th:value="1" th:text="社内業務（オンサイト）"></option>
                  <option th:value="2" th:text="社内業務（オフサイト）"></option>
                  <option th:value="3" th:text="顧客業務（オンサイト）"></option>
                  <option th:value="4" th:text="顧客業務（オフサイト）"></option>
                  <option th:value="5" th:text="休日"></option>
                </select>
              </td>
              <td>
                <input type="time" th:field="*{attendances[__${iterStat.index}__].workTimeStart}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
              </td>
              <td>
                <input type="time" th:field="*{attendances[__${iterStat.index}__].workTimeFinish}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
              </td>
              <td>
                <input type="time" th:field="*{attendances[__${iterStat.index}__].breakTime}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
              </td>
              <td>
                <textarea th:field="*{attendances[__${iterStat.index}__].memo}" class="form-control" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"></textarea>
              </td>
              <input type="hidden" th:field="*{attendances[__${iterStat.index}__].date}" th:value="${#dates.format(date, 'yyyy/MM/dd')}"/>
          </p>
        </span>
        </tr>
        </tbody>
    </table>
    <input type="submit" value="更新" class="btn btn-primary update-button" th:attr="disabled=${monthAttendance.attendanceStatus != 0}"/>
</form>
<a th:href="@{/}">
    <input type="button" value="戻る" class="btn btn-secondary btn-sm return-button-all">
</a>
</body>
</html>