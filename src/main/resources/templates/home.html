<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" >
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <meta charset="UTF-8">
    <link th:href="@{/css/style.css}" rel="styleSheet">
    <script th:src="@{/js/script.js}"></script>
    <title>ホーム画面</title>
</head>
<body>
<div class="header-contents">
    <h1 class="container text-center my-3">勤怠管理システム</h1>

        <!-- 承認者orシステム管理者フィルターのエラーメッセージ表示 -->
        <div th:if="${filterErrorMessages}" th:each="filterErrorMessage : ${filterErrorMessages}" class="alert alert-danger">
            <span><div th:text="${filterErrorMessage}" /></span>
        </div>
        <!-- 完了申請のエラーメッセージ表示 -->
        <div th:if="${requestErrorMessages}" th:each="requestErrorMessage : ${requestErrorMessages}" class="alert alert-danger">
            <span><div th:text="${requestErrorMessage}" /></span>
        </div>
        <!-- 勤怠編集画面の不正なパラメーターのエラーメッセージ表示 -->
        <div th:if="${parameterErrorMessages}" th:each="parameterErrorMessage : ${parameterErrorMessages}" class="alert alert-danger">
            <span><div th:text="${parameterErrorMessage}" /></span>
        </div>

    <div class="header">
        <div class="me-3 fs-6">
            社員番号：<span th:text="${loginUser.employeeNumber}"/><br>
            　　氏名：<span th:text="${loginUser.name}"/><br>
        </div>
        <br/>
        <div th:if="${session.loginUser.positionId == 2}" class="header-item">
            <a th:href="@{/show_users}" class="header-item">
                <input type="button" value="承認一覧" class="btn btn-secondary me-3">
            </a>
        </div>
        <div th:if="${session.loginUser.positionId == 3}" class="header-item">
            <a th:href="@{/systemManage}" class="header-item">
                <input type="button" value="システム管理" class="btn btn-secondary me-3">
            </a>
        </div>
        <form th:action="@{/setting}" method="get" class="header-item">
            <button type="submit" class="btn btn-secondary me-3">設定</button>
        </form>
        <form th:action="@{/logout}" method="get" class="header-item">
            <button type="submit" class="btn btn-secondary me-3">ログアウト</button>
        </form>
    </div>
    <!--新規登録は非表示
    <div class="judge-status" th:if="${monthAttendance.attendanceStatus == 0}">
        <form th:action="@{/newAttendance}" method="get" class="new-button">
            <input type="submit" value="新規勤怠登録" class="btn btn-secondary btn-lg">
        </form>
    </div>
    -->
</div>
<br/>

<select class="form-control">
    <option value="" disabled selected>選択してください</option>
    <option value="">選択してください</option>
</select>

<a th:href="@{/prevMonth}">
    <input type="button" value="前月へ">
</a>
<a th:href="@{/nextMonth}">
    <input type="button" value="翌月へ">
</a>

<table class="table table-hover">
    <thead class="table-light">
    <tr>
        <th>日付</th>
        <th>勤務区分</th>
        <th>開始時刻</th>
        <th>終了時刻</th>
        <th>休憩時間</th>
        <th>労働時間</th>
        <th>メモ</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="monthDate : ${monthDates}" class="align-middle">
        <td th:text="${#dates.format(monthDate, 'yyyy年MM月dd日')}"></td>
        <!--<span th:each="attendance : ${attendances}">-->
            <!--<span th:if="${(attendance.date).compareTo(monthDate) == 0}">-->
            <span th:switch="${monthDate}">
                <span th:each="attendance : ${attendances}">
                    <p th:case="${attendance.date}">
                        <td th:switch="${attendance.attendance}">
                            <span th:case="0" th:text="未登録">未登録</span>
                            <span th:case="1" th:text="社内業務（オンサイト）">未登録</span>
                            <span th:case="2" th:text="社内業務（オフサイト）">未登録</span>
                            <span th:case="3" th:text="顧客業務（オンサイト）">未登録</span>
                            <span th:case="4" th:text="顧客業務（オフサイト）">未登録</span>
                            <span th:case="5" th:text="休日"></span>
                        </td>
                        <td th:text="${#temporals.format(attendance.workTimeStart, 'H:mm')}"></td>
                        <td th:text="${#temporals.format(attendance.workTimeFinish, 'H:mm')}"></td>
                        <!-- 時間が0から始まる場合(ex.08:00:00)は2文字目から5文字目で切り取り。そうでないとき(ex.16:00:00)は1文字目から5文字目で切り取る -->
                        <td th:text="${attendance.breakTime != null && attendance.breakTime.startsWith('0') ? #strings.substring(attendance.breakTime, 1, 5) : #strings.substring(attendance.breakTime, 0, 5)}"></td>
                        <td th:text="${attendance.workTime != null && attendance.workTime.startsWith('0') ? #strings.substring(attendance.workTime, 1, 5) : #strings.substring(attendance.workTime, 0, 5)}"></td>
                        <td th:text="${attendance.memo}"></td>
                        <td th:if="${attendanceStatus == 0}"><a th:href="@{/editAttendance}"><input type="submit" value="編集" class="btn btn-outline-secondary"></a></td>
                        <!--<div class="judge-status" th:if="${attendanceStatus == 0}">
                            <td><a th:href="@{/editAttendance/{id}(id=${attendance.id})}"><input type="submit" value="編集" class="btn btn-outline-secondary"></a></td>
                        </div>-->
                        <!-- 申請中/承認済みの時の編集ボタンの表示 -->
                        <td th:if="${attendanceStatus != 0}">
                        <button disabled class="btn btn-outline-secondary">編集</button>
                        </td>
                    </p>
                </span>
                <p th:case="*">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td th:if="${attendanceStatus == 0}"><a th:href="@{/editAttendance}"><input type="submit" value="編集" class="btn btn-outline-secondary"></a></td>
                    <!-- 申請中/承認済みの時の編集ボタンの表示 -->
                    <td th:if="${attendanceStatus != 0}">
                        <button disabled class="btn btn-outline-secondary">編集</button>
                    </td>
                </p>
            </span>
            <!--
            <span th:unless="${(attendance.date).compareTo(monthDate) == 0}"></span>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </span>
            -->
    </tr>
    </tbody>
</table>

<!--勤怠登録updateにしてた時の表示。表記確認のために残している状態です-->
<table class="table table-hover">
    <thead class="table-light">
        <tr>
            <th>日付</th>
            <th>勤務区分</th>
            <th>開始時刻</th>
            <th>終了時刻</th>
            <th>休憩時間</th>
            <th>労働時間</th>
            <th>メモ</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="attendance : ${attendances}" class="align-middle">
            <td th:text="${#dates.format(attendance.date, 'yyyy年MM月dd日')}"></td>
            <td th:switch="${attendance.attendance}">
                <span th:case="0" th:text="未登録"></span>
                <span th:case="1" th:text="社内業務（オンサイト）"></span>
                <span th:case="2" th:text="社内業務（オフサイト）"></span>
                <span th:case="3" th:text="顧客業務（オンサイト）"></span>
                <span th:case="4" th:text="顧客業務（オフサイト）"></span>
                <span th:case="5" th:text="休日"></span>
            </td>
            <td th:text="${#temporals.format(attendance.workTimeStart, 'H:mm')}"></td>
            <td th:text="${#temporals.format(attendance.workTimeFinish, 'H:mm')}"></td>
            <!-- 時間が0から始まる場合(ex.08:00:00)は2文字目から5文字目で切り取り。そうでないとき(ex.16:00:00)は1文字目から5文字目で切り取る -->
            <td th:text="${attendance.breakTime != null && attendance.breakTime.startsWith('0') ? #strings.substring(attendance.breakTime, 1, 5) : #strings.substring(attendance.breakTime, 0, 5)}"></td>
            <td th:text="${attendance.workTime != null && attendance.workTime.startsWith('0') ? #strings.substring(attendance.workTime, 1, 5) : #strings.substring(attendance.workTime, 0, 5)}"></td>
            <td th:text="${attendance.memo}"></td>
            <div class="judge-status" th:if="${monthAttendance.attendanceStatus == 0}">
                <td><form th:action="@{/newOrEdit}" th:method="get"><input type="submit" value="編集" class="btn btn-outline-secondary">
                <!--idとdateの渡し方は調整が必要-->
                <input type="hidden" name="id" th:value="${attendance.id}">
                <input type="hidden" name="date" th:value="2024-12-16">
                </form></td>
            </div>
            <!-- 承認済みの時の編集ボタンの表示 -->
            <td th:if="${monthAttendance.attendanceStatus != 0}">
                <button disabled class="btn btn-outline-secondary">編集</button>
            </td>
        </tr>
    </tbody>
</table>
    </div>
</div>
<div class="text-center">
    <th:block th:switch="${attendanceStatus}">
        <span th:case="0">
            <form th:action="@{/request}" th:method="put" class="header-item" onSubmit="return CheckRequest()">
                <input type="submit" value="申請" class="btn btn-primary">
            </form>
        </span>
        <span th:case="1">
            <button disabled class="btn btn-secondary">申請中</button>
        </span>
        <span th:case="2">
            <button disabled class="btn btn-secondary">承認済み</button>
        </span>
    </th:block>
</div>
</body>
</html>